---
title: "readme"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goal of the project

Construction d'une base de données publique contenant des données ANTARES provenant du SI transparency.

- identifier les sources problématiques :
    * y a t-il des données manquantes et où sont-elles?
    * y a t-il des données nulles et où sont-elles?
- quelles données sont mauvaises
- Substituer de façon mécanique quand c'est possible des données manquantes par d'autres données supposées valides et échangeable.
- comment estimer la données identifiée mauvaise


## Installation

This package is only available on Github. To install the last development version:

```{r eval=FALSE}
devtools::install_github("rte-antares-rpackage/antaDraft")
```


## Usage

> Scope is only on load data for now. Goal is to extend scope to production data.

### Raw data importation

```{r}
library(antadraft)
library(dplyr)

rep_path <- system.file(package = "antadraft", "files", "load")
load_db <- read_load_files(rep_path)
head(load_db)
```

### Préparation au format *antares*

```{r}
db <- fortify_from_rules(raw_db = load_db )
head(db)
```

### Recherche des anomalies

La fonction `qualcon` permet de tester les cohérences définies dans le fichier `validation_rules`. Il s'agit d'un fichier yaml exprimant les expressions R représentant ces tests.

La fonction retourne un data.frame décrivant chaque invalidité, par pays et période entière.

```{r}
db_erros <- qualcon(db)
db_erros
```

Une vue synthétique peut être obtenue avec la fonction `fortify_qualcon`.


```{r}
erros_summary <- fortify_qualcon(db_erros)
erros_summary %>% arrange(country, start, end)
```


### Détails des anomalies

Les données brutes attachées à un problème identifié peuvent être obtenues avec la fonction `extract_raw_data`. 

```{r}
extract_raw_data(load_db, db_erros)
```

### Correction des données

```{r}
yaml_valid <- system.file(package = "antadraft", "validation_rules.yml" )
yaml_correct <- system.file(package = "antadraft", "yaml_data/correction/cty_correct.yml" )
correct_db(db, v_rules = yaml_valid, c_rules = yaml_correct ) %>% head()
```
